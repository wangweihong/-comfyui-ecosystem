{"revision":0,"last_node_id":65,"last_link_id":0,"nodes":[{"id":65,"type":"7c80c529-493d-497f-8503-568676b648a7","pos":[287.518923846745,152.80423901845853],"size":[397.5,263.6363636363636],"flags":{},"order":4,"mode":0,"inputs":[{"label":"音频","localized_name":"audio","name":"audio","type":"AUDIO","link":null},{"label":"模型","name":"model","type":"COMBO","widget":{"name":"model"},"link":null},{"label":"语言","name":"language","type":"COMBO","widget":{"name":"language"},"link":null},{"label":"语音识别或翻译","name":"task","type":"COMBO","widget":{"name":"task"},"link":null},{"label":"字幕格式","name":"subtitle_format","type":"COMBO","widget":{"name":"subtitle_format"},"link":null}],"outputs":[{"label":"字幕文件","localized_name":"subtitle text","name":"subtitle text","type":"SUBTITLE","links":[]},{"label":"纯文本","name":"pure text","type":"STRING","links":[]}],"properties":{"proxyWidgets":[["-1","model"],["-1","language"],["-1","task"],["-1","subtitle_format"]],"ue_properties":{"widget_ue_connectable":{},"input_ue_unconnectable":{},"version":"7.5.2"},"cnr_id":"comfy-core","ver":"0.4.0"},"widgets_values":["faster-whisper-large-v3","auto","transcribe",".vtt"],"title":"custom-语音识别翻译-fastwhisper"}],"links":[],"version":0.4,"definitions":{"subgraphs":[{"id":"7c80c529-493d-497f-8503-568676b648a7","version":1,"state":{"lastGroupId":0,"lastNodeId":67,"lastLinkId":55,"lastRerouteId":0},"revision":0,"config":{},"name":"custom-语音识别翻译-fastwhisper","inputNode":{"id":-10,"bounding":[-377.84365822006623,130.80423901845853,124.00064086914062,140]},"outputNode":{"id":-20,"bounding":[972.8815059135562,120.80423901845853,120,80]},"inputs":[{"id":"3b393633-a0e2-455a-8984-162e619eef89","name":"audio","type":"AUDIO","linkIds":[48],"localized_name":"audio","label":"音频","pos":[-273.8430173509256,150.80423901845853]},{"id":"e26400b1-2f70-4454-b1fe-33f1657d612f","name":"model","type":"COMBO","linkIds":[50],"label":"模型","pos":[-273.8430173509256,170.80423901845853]},{"id":"183208b4-9cd9-4efb-9bf2-a4d67ea3df9b","name":"language","type":"COMBO","linkIds":[51],"label":"语言","pos":[-273.8430173509256,190.80423901845853]},{"id":"c58cf565-a9c5-4005-ae41-75f09e3c3b94","name":"task","type":"COMBO","linkIds":[53],"label":"语音识别或翻译","pos":[-273.8430173509256,210.80423901845853]},{"id":"d128d3cc-4d9c-44b1-8c92-537c5989179c","name":"subtitle_format","type":"COMBO","linkIds":[54],"label":"字幕格式","pos":[-273.8430173509256,230.80423901845853]}],"outputs":[{"id":"d69d75d8-4f62-4b2e-8fdd-743c3994c0a3","name":"subtitle text","type":"SUBTITLE","linkIds":[39],"localized_name":"subtitle text","label":"字幕文件","pos":[992.8815059135562,140.80423901845853]},{"id":"5753b716-c544-491b-96d6-697bc580de07","name":"pure text","type":"STRING","linkIds":[55],"label":"纯文本","pos":[992.8815059135562,160.80423901845853]}],"widgets":[],"nodes":[{"id":44,"type":"Note","pos":[-197.84365822006626,494.7252919882528],"size":[361.1064453125,88],"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[],"properties":{"text":"","ue_properties":{"widget_ue_connectable":{},"version":"7.5.2","input_ue_unconnectable":{}}},"widgets_values":["Since I can not use None value as default in ComfyUI, \n\nI used `-999` and empty strings as None value in some parameters."],"color":"#432","bgcolor":"#653"},{"id":59,"type":"Note","pos":[524.435361524512,-106.04193575275401],"size":[388.4461443890442,713.9853835120548],"flags":{"pinned":true},"order":1,"mode":0,"inputs":[],"outputs":[],"properties":{"ue_properties":{"widget_ue_connectable":{},"version":"7.5.2","input_ue_unconnectable":{}}},"widgets_values":["1. 核心任务参数\n\n    language: 指定音频语言。设置为 auto 时模型会自动检测；指定如 zh 或 en 可提高识别速度和准确率。\n\n    task:\n\n        transcribe: 语音转文字（默认）。\n\n        translate: 语音翻译（通常是将源语言直接翻译为英文）。\n\n2. 搜索策略（解码质量）\n\n    beam_size: 束搜索大小。模型在解码时会保留前 N 个可能性。值越大越准确，但速度越慢（通常 5 是平衡点）。\n\n    best_of: 非束搜索时采样的候选数量。与 beam_size 类似，增加它会提高搜索质量。\n\n    patience: 束搜索的耐心系数。值 > 1 会让搜索更倾向于找到全局更优解。\n\n    temperature: 温度系数。0.0 表示结果最稳定（确定性）；值越高，结果越随机，有时用于解决模型反复卡在某句话的情况。\n\n3. 阈值与过滤（解决“幻觉”）\n\n    log_prob_threshold: 概率阈值。如果该片段的平均对数概率低于此值，则认为识别不可靠。\n\n    no_speech_threshold: 无声检测阈值。如果模型认为“没有说话”的概率高于此值，该片段会被跳过。\n\n    compression_ratio_threshold: 压缩比阈值。用于检测文本是否陷入了死循环（比如不停重复某个字）。\n\n    hallucination_silence_threshold: 幻觉静音阈值。当检测到长时间静音时，强制结束当前生成，防止模型胡言乱语。\n\n4. 文本约束与格式\n\n    prefix: 强制前缀。引导模型以特定词汇开始识别。\n\n    initial_prompt: 初始提示词。告诉模型背景（如专业术语、人名），让模型更准确地拼写相关词汇。\n\n    hotwords: 热词。提供关键词列表，增加模型识别这些特定词汇的权重。\n\n    suppress_blank: 是否抑制空输出。开启后，模型会尽量避免产生空白行。\n\n    suppress_tokens: 抑制特定字符代码（Token）。默认为 [-1]，通常用于屏蔽某些特殊符号。\n\n    prepend/append_punctuations: 标点符号偏好。指定模型在识别时优先考虑的起始/结束标点。\n\n5. 时间轴控制\n\n    word_timestamps: 单词级时间戳。开启后会计算每个单词的确切时间，而不是仅提供一整句的时间轴。\n\n    max_initial_timestamp: 限制首个时间戳出现的时间。如果音频开头有很长的静音，可以调整此值。\n\n    without_timestamps: 是否输出时间戳。如果只需要纯文本，可以关闭。\n\n    clip_timestamps: 指定识别音频的特定范围（例如只处理 10s 到 30s）。\n\n6. 长音频处理与 VAD\n\n    chunk_length: 分段长度。将长音频切分成多少秒的小段进行处理。\n\n    condition_on_previous_text: 上下文关联。开启后，模型会参考前一段识别的内容来识别下一段，有助于保持语义连贯，但有时会导致错误累积。\n\n    vad_filter: VAD（语音活跃检测）过滤器。开启后，程序会先剔除完全没有声音的部分，能大幅提升速度并减少幻觉。\n\n    vad_parameters: VAD 的高级微调参数（如攻击时间、释放时间等）。\n\n7. 语言检测\n\n    language_detection_threshold: 只有当语言检测的置信度高于此值时才确定语言。\n\n    language_detection_segments: 用于检测语言的采样片段数量。\n\n建议建议： 如果你在识别时发现模型频繁重复说话或者胡言乱语，建议开启 vad_filter=True 并适当调高 no_speech_threshold。"],"color":"#432","bgcolor":"#653"},{"id":60,"type":"PrimitiveBoolean","pos":[-152.74521875314915,382.4427422182047],"size":[270,58],"flags":{},"order":2,"mode":0,"inputs":[{"localized_name":"值","name":"value","type":"BOOLEAN","widget":{"name":"value"},"link":null}],"outputs":[{"localized_name":"布尔","name":"BOOLEAN","type":"BOOLEAN","links":[46]}],"properties":{"ue_properties":{"widget_ue_connectable":{},"input_ue_unconnectable":{},"version":"7.5.2"},"cnr_id":"comfy-core","ver":"0.4.0","Node name for S&R":"PrimitiveBoolean"},"widgets_values":[true]},{"id":63,"type":"Audio Resample (mtb)","pos":[-159.46838656955458,-105.5866700487166],"size":[270,58],"flags":{},"order":8,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"AUDIO","link":48},{"localized_name":"sample_rate","name":"sample_rate","type":"INT","widget":{"name":"sample_rate"},"link":null}],"outputs":[{"localized_name":"resampled_audio","name":"resampled_audio","type":"AUDIO","links":[49]}],"properties":{"ue_properties":{"widget_ue_connectable":{},"input_ue_unconnectable":{},"version":"7.5.2"},"cnr_id":"comfy-mtb","ver":"eabe43db79112d4e3674db343c5c184145e8396c","Node name for S&R":"Audio Resample (mtb)"},"widgets_values":[16000]},{"id":64,"type":"Note","pos":[-172.82151530264878,-256.33496972238373],"size":[315,103.18181818181819],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[],"properties":{"ue_properties":{"widget_ue_connectable":{},"version":"7.5.2","input_ue_unconnectable":{}}},"widgets_values":["音频采样率设置为16000 HZ可以有效的提高准确率"],"color":"#432","bgcolor":"#653"},{"id":43,"type":"LoadFasterWhisperModel","pos":[-166.62775766682606,11.957175056348568],"size":[315,82],"flags":{},"order":6,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"COMBO","widget":{"name":"model"},"link":50},{"localized_name":"device","name":"device","type":"COMBO","widget":{"name":"device"},"link":null}],"outputs":[{"localized_name":"faster_whisper_model","name":"faster_whisper_model","type":"FASTERWHISPERMODEL","slot_index":0,"links":[41]}],"properties":{"ue_properties":{"widget_ue_connectable":{},"version":"7.5.2","input_ue_unconnectable":{}},"cnr_id":"comfyui-faster-whisper","ver":"a8f39d5ae4cd160ba1ec429492025a75a8422928","Node name for S&R":"LoadFasterWhisperModel"},"widgets_values":["faster-whisper-large-v3","cuda"]},{"id":62,"type":"PrimitiveFloat","pos":[-153.95103115660157,274.67812408815405],"size":[270,58],"flags":{},"order":4,"mode":0,"inputs":[{"localized_name":"值","name":"value","type":"FLOAT","widget":{"name":"value"},"link":null}],"outputs":[{"localized_name":"浮点","name":"FLOAT","type":"FLOAT","links":[47]}],"properties":{"ue_properties":{"widget_ue_connectable":{},"input_ue_unconnectable":{},"version":"7.5.2"},"cnr_id":"comfy-core","ver":"0.4.0","Node name for S&R":"PrimitiveFloat"},"widgets_values":[0.9]},{"id":49,"type":"FasterWhisperTranscription","pos":[193,-226],"size":[315,822],"flags":{},"order":7,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"AUDIO","link":49},{"localized_name":"model","name":"model","type":"FASTERWHISPERMODEL","link":41},{"localized_name":"language","name":"language","shape":7,"type":"COMBO","widget":{"name":"language"},"link":51},{"localized_name":"task","name":"task","shape":7,"type":"COMBO","widget":{"name":"task"},"link":53},{"localized_name":"beam_size","name":"beam_size","shape":7,"type":"INT","widget":{"name":"beam_size"},"link":null},{"localized_name":"log_prob_threshold","name":"log_prob_threshold","shape":7,"type":"FLOAT","widget":{"name":"log_prob_threshold"},"link":null},{"localized_name":"no_speech_threshold","name":"no_speech_threshold","shape":7,"type":"FLOAT","widget":{"name":"no_speech_threshold"},"link":47},{"localized_name":"best_of","name":"best_of","shape":7,"type":"INT","widget":{"name":"best_of"},"link":null},{"localized_name":"patience","name":"patience","shape":7,"type":"FLOAT","widget":{"name":"patience"},"link":null},{"localized_name":"temperature","name":"temperature","shape":7,"type":"FLOAT","widget":{"name":"temperature"},"link":null},{"localized_name":"compression_ratio_threshold","name":"compression_ratio_threshold","shape":7,"type":"FLOAT","widget":{"name":"compression_ratio_threshold"},"link":null},{"localized_name":"length_penalty","name":"length_penalty","shape":7,"type":"FLOAT","widget":{"name":"length_penalty"},"link":null},{"localized_name":"repetition_penalty","name":"repetition_penalty","shape":7,"type":"FLOAT","widget":{"name":"repetition_penalty"},"link":null},{"localized_name":"no_repeat_ngram_size","name":"no_repeat_ngram_size","shape":7,"type":"INT","widget":{"name":"no_repeat_ngram_size"},"link":null},{"localized_name":"prefix","name":"prefix","shape":7,"type":"STRING","widget":{"name":"prefix"},"link":null},{"localized_name":"suppress_blank","name":"suppress_blank","shape":7,"type":"BOOLEAN","widget":{"name":"suppress_blank"},"link":null},{"localized_name":"suppress_tokens","name":"suppress_tokens","shape":7,"type":"STRING","widget":{"name":"suppress_tokens"},"link":null},{"localized_name":"max_initial_timestamp","name":"max_initial_timestamp","shape":7,"type":"FLOAT","widget":{"name":"max_initial_timestamp"},"link":null},{"localized_name":"word_timestamps","name":"word_timestamps","shape":7,"type":"BOOLEAN","widget":{"name":"word_timestamps"},"link":null},{"localized_name":"prepend_punctuations","name":"prepend_punctuations","shape":7,"type":"STRING","widget":{"name":"prepend_punctuations"},"link":null},{"localized_name":"append_punctuations","name":"append_punctuations","shape":7,"type":"STRING","widget":{"name":"append_punctuations"},"link":null},{"localized_name":"max_new_tokens","name":"max_new_tokens","shape":7,"type":"INT","widget":{"name":"max_new_tokens"},"link":null},{"localized_name":"chunk_length","name":"chunk_length","shape":7,"type":"INT","widget":{"name":"chunk_length"},"link":null},{"localized_name":"hallucination_silence_threshold","name":"hallucination_silence_threshold","shape":7,"type":"FLOAT","widget":{"name":"hallucination_silence_threshold"},"link":null},{"localized_name":"hotwords","name":"hotwords","shape":7,"type":"STRING","widget":{"name":"hotwords"},"link":null},{"localized_name":"language_detection_threshold","name":"language_detection_threshold","shape":7,"type":"FLOAT","widget":{"name":"language_detection_threshold"},"link":null},{"localized_name":"language_detection_segments","name":"language_detection_segments","shape":7,"type":"INT","widget":{"name":"language_detection_segments"},"link":null},{"localized_name":"prompt_reset_on_temperature","name":"prompt_reset_on_temperature","shape":7,"type":"FLOAT","widget":{"name":"prompt_reset_on_temperature"},"link":null},{"localized_name":"condition_on_previous_text","name":"condition_on_previous_text","shape":7,"type":"BOOLEAN","widget":{"name":"condition_on_previous_text"},"link":null},{"localized_name":"initial_prompt","name":"initial_prompt","shape":7,"type":"STRING","widget":{"name":"initial_prompt"},"link":null},{"localized_name":"without_timestamps","name":"without_timestamps","shape":7,"type":"BOOLEAN","widget":{"name":"without_timestamps"},"link":null},{"localized_name":"vad_filter","name":"vad_filter","shape":7,"type":"BOOLEAN","widget":{"name":"vad_filter"},"link":46},{"localized_name":"vad_parameters","name":"vad_parameters","shape":7,"type":"STRING","widget":{"name":"vad_parameters"},"link":null},{"localized_name":"clip_timestamps","name":"clip_timestamps","shape":7,"type":"STRING","widget":{"name":"clip_timestamps"},"link":null}],"outputs":[{"localized_name":"transcriptions","name":"transcriptions","type":"TRANSCRIPTIONS","slot_index":0,"links":[42]}],"properties":{"ue_properties":{"widget_ue_connectable":{},"version":"7.5.2","input_ue_unconnectable":{}},"cnr_id":"comfyui-faster-whisper","ver":"a8f39d5ae4cd160ba1ec429492025a75a8422928","Node name for S&R":"FasterWhisperTranscription"},"widgets_values":["auto","transcribe",5,-1,0.6,5,1,0,2.4,1,1,0,"",true,"[-1]",1,false,"\"'“¿([{-","\"'.。,，!！?？:：”)]}、",-999,-999,-999,"",-999,1,0.5,true,"",false,false,"","0"]},{"id":41,"type":"FasterWhisperToSubtitle","pos":[520.8512396694217,-224.4430708284956],"size":[355.20001220703125,78],"flags":{},"order":5,"mode":0,"inputs":[{"localized_name":"transcriptions","name":"transcriptions","type":"TRANSCRIPTIONS","link":42},{"localized_name":"subtitle_format","name":"subtitle_format","type":"COMBO","widget":{"name":"subtitle_format"},"link":54}],"outputs":[{"localized_name":"subtitle text","name":"subtitle text","type":"SUBTITLE","slot_index":0,"links":[39]},{"localized_name":"pure text","name":"pure text","type":"STRING","links":[55]}],"properties":{"ue_properties":{"widget_ue_connectable":{},"version":"7.5.2","input_ue_unconnectable":{}},"cnr_id":"comfyui-faster-whisper","ver":"a8f39d5ae4cd160ba1ec429492025a75a8422928","Node name for S&R":"FasterWhisperToSubtitle"},"widgets_values":[".vtt"]}],"groups":[],"links":[{"id":42,"origin_id":49,"origin_slot":0,"target_id":41,"target_slot":0,"type":"TRANSCRIPTIONS"},{"id":49,"origin_id":63,"origin_slot":0,"target_id":49,"target_slot":0,"type":"AUDIO"},{"id":41,"origin_id":43,"origin_slot":0,"target_id":49,"target_slot":1,"type":"FASTERWHISPERMODEL"},{"id":47,"origin_id":62,"origin_slot":0,"target_id":49,"target_slot":6,"type":"FLOAT"},{"id":46,"origin_id":60,"origin_slot":0,"target_id":49,"target_slot":31,"type":"BOOLEAN"},{"id":48,"origin_id":-10,"origin_slot":0,"target_id":63,"target_slot":0,"type":"AUDIO"},{"id":39,"origin_id":41,"origin_slot":0,"target_id":-20,"target_slot":0,"type":"SUBTITLE"},{"id":50,"origin_id":-10,"origin_slot":1,"target_id":43,"target_slot":0,"type":"COMBO"},{"id":51,"origin_id":-10,"origin_slot":2,"target_id":49,"target_slot":2,"type":"COMBO"},{"id":53,"origin_id":-10,"origin_slot":3,"target_id":49,"target_slot":3,"type":"COMBO"},{"id":54,"origin_id":-10,"origin_slot":4,"target_id":41,"target_slot":1,"type":"COMBO"},{"id":55,"origin_id":41,"origin_slot":1,"target_id":-20,"target_slot":1,"type":"STRING"}],"extra":{"workflowRendererVersion":"LG","ue_links":[],"links_added_by_ue":[]}}]}}